

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ImageAI：图像预测 &mdash; ImageAI v1.0 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ImageAI
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">ImageAI：图像预测</a><ul>
<li><a class="reference internal" href="#"><strong>目录</strong></a></li>
<li><a class="reference internal" href="#firstprediction-py"><strong>FirstPrediction.py</strong></a></li>
<li><a class="reference internal" href="#"><strong>多图像预测</strong></a></li>
<li><a class="reference internal" href="#"><strong>预测速度</strong></a></li>
<li><a class="reference internal" href="#">请注意：</a></li>
<li><a class="reference internal" href="#"><strong>图像输入类型</strong></a></li>
<li><a class="reference internal" href="#"><strong>多线程预测</strong></a></li>
<li><a class="reference internal" href="#"><strong>文档</strong></a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ImageAI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>ImageAI：图像预测</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ImageAI_Image_Prediction.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="imageai">
<span id="imageai"></span><h1><a class="reference external" href="#imageai--image-prediction-"></a>ImageAI：图像预测<a class="headerlink" href="#imageai" title="永久链接至标题">¶</a></h1>
<p><strong>AI共享</strong>项目<a class="reference external" href="https://commons.specpal.science">https://commons.specpal.science</a></p>
<hr class="docutils" />
<div class="section" id="">
<span id="id1"></span><h2><a class="reference external" href="#table-of-contents"></a><strong>目录</strong><a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="#firstprediction">第一次预测</a></li>
<li><a class="reference external" href="#predictionspeed">预测速度</a></li>
<li><a class="reference external" href="#inputtype">图像输入类型</a></li>
<li><a class="reference external" href="#multiprediction">多图像预测多线程</a></li>
<li><a class="reference external" href="#threadprediction">预测</a></li>
<li><a class="reference external" href="#documentation">文档</a></li>
</ul>
<p>ImageAI提供4种不同的算法和模型类型来执行图像预测。要对任何图片执行图像预测，请执行以下简单步骤。提供用于图像预测的4种算法包括<strong>SqueezeNet</strong>，<strong>ResNet</strong>，<strong>InceptionV3</strong>和<strong>DenseNet</strong>。这些算法中的每一个都有单独的模型文件，您必须根据算法的使用选择这些模型文件。要下载所选算法的模型文件，请单击以下任意链接：</p>
<p><strong>- <a class="reference external" href="https://github.com/OlafenwaMoses/ImageAI/releases/download/1.0/squeezenet_weights_tf_dim_ordering_tf_kernels.h5">SqueezeNet</a>（文件大小：4.82 MB，最快的预测时间和适中的准确度）</strong></p>
<p><strong>-<a class="reference external" href="https://github.com/OlafenwaMoses/ImageAI/releases/download/1.0/resnet50_weights_tf_dim_ordering_tf_kernels.h5"></a></strong> <strong><a class="reference external" href="https://github.com/OlafenwaMoses/ImageAI/releases/download/1.0/resnet50_weights_tf_dim_ordering_tf_kernels.h5">ResNet50</a></strong> by Microsoft Research<strong>（文件大小：98 MB，快速预测时间和高精度）</strong></p>
<p><strong>-<a class="reference external" href="https://github.com/OlafenwaMoses/ImageAI/releases/download/1.0/inception_v3_weights_tf_dim_ordering_tf_kernels.h5"></a></strong>  <strong><a class="reference external" href="https://github.com/OlafenwaMoses/ImageAI/releases/download/1.0/inception_v3_weights_tf_dim_ordering_tf_kernels.h5">InceptionV3</a></strong> by Google Brain team<strong>（文件大小：91.6 MB，预测时间慢，精度更高）</strong></p>
<p><strong>-<a class="reference external" href="https://github.com/OlafenwaMoses/ImageAI/releases/download/1.0/DenseNet-BC-121-32.h5"></a></strong> <strong><a class="reference external" href="https://github.com/OlafenwaMoses/ImageAI/releases/download/1.0/DenseNet-BC-121-32.h5">DenseNet121</a></strong> by Facebook AI Research<strong>（文件大小：31.6 MB，预测时间较慢，精度最高）</strong></p>
<p>很好！下载此模型文件后，启动一个新的python项目，然后将模型文件复制到python文件（.py文件）所在的项目文件夹中。下载下面的图像，或者在计算机上拍摄任何图像并将其复制到python项目的文件夹中。然后创建一个python文件并为其命名; 例如<strong>FirstPrediction.py</strong>。然后将下面的代码写入python文件：</p>
</div>
<div class="section" id="firstprediction-py">
<span id="firstprediction-py"></span><h2><a class="reference external" href="#firstpredictionpy"></a><strong>FirstPrediction.py</strong><a class="headerlink" href="#firstprediction-py" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">imageai.Prediction</span> <span class="k">import</span> <span class="n">ImagePrediction</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">execution_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">ImagePrediction</span><span class="p">()</span>
<span class="n">prediction</span><span class="o">.</span><span class="n">setModelTypeAsResNet</span><span class="p">()</span>
<span class="n">prediction</span><span class="o">.</span><span class="n">setModelPath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">execution_path</span><span class="p">,</span> <span class="s2">&quot;resnet50_weights_tf_dim_ordering_tf_kernels.h5&quot;</span><span class="p">))</span>
<span class="n">prediction</span><span class="o">.</span><span class="n">loadModel</span><span class="p">()</span>

<span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">predictImage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">execution_path</span><span class="p">,</span> <span class="s2">&quot;1.jpg&quot;</span><span class="p">),</span> <span class="n">result_count</span><span class="o">=</span><span class="mi">5</span> <span class="p">)</span>
<span class="k">for</span> <span class="n">eachPrediction</span><span class="p">,</span> <span class="n">eachProbability</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">eachPrediction</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="n">eachProbability</span><span class="p">)</span>
</pre></div>
</div>
<p>示例结果：
<a class="reference external" href="/OlafenwaMoses/ImageAI/blob/master/images/1.jpg"><img alt="" src="https://github.com/OlafenwaMoses/ImageAI/raw/master/images/1.jpg" /></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">convertible</span> <span class="p">:</span> <span class="mf">52.459555864334106</span>
<span class="n">sports_car</span> <span class="p">:</span> <span class="mf">37.61284649372101</span>
<span class="n">pickup</span> <span class="p">:</span> <span class="mf">3.1751200556755066</span>
<span class="n">car_wheel</span> <span class="p">:</span> <span class="mf">1.817505806684494</span>
<span class="n">minivan</span> <span class="p">:</span> <span class="mf">1.7487050965428352</span>
</pre></div>
</div>
<p>我们来分析示例的代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">imageai.Prediction</span> <span class="k">import</span> <span class="n">ImagePrediction</span>
<span class="kn">import</span> <span class="nn">os</span> 
</pre></div>
</div>
<p>上面的代码导入了<strong>ImageAI</strong>库和python <strong>os</strong>类。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">execution_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</pre></div>
</div>
<p>上面的代码获取包含python文件的文件夹路径（在本例中python文件为FirstPrediction.py）。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prediction</span> <span class="o">=</span> <span class="n">ImagePrediction</span><span class="p">()</span>
<span class="n">prediction</span><span class="o">.</span><span class="n">setModelTypeAsResNet</span><span class="p">()</span>
<span class="n">prediction</span><span class="o">.</span><span class="n">setModelPath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">execution_path</span><span class="p">,</span> <span class="s2">&quot;resnet50_weights_tf_dim_ordering_tf_kernels.h5&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>在上面的代码中，我们在第一行创建了<strong>ImagePrediction（）</strong>类的实例，然后我们通过 在第二行中调用<strong>.setModelTypeAsResNet（）</strong>将预测对象的模型类型设置为ResNet ，在第三行中设置模型文件的路径（<strong>resnet50_weights_tf_dim_ordering_tf_kernels.h5</strong>）。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">predictImage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">execution_path</span><span class="p">,</span> <span class="s2">&quot;1.jpg&quot;</span><span class="p">),</span> <span class="n">result_count</span><span class="o">=</span><span class="mi">5</span> <span class="p">)</span>
</pre></div>
</div>
<p>在上面的行中，我们定义了两个变量，它们将调用函数来赋值，即<strong>.predictImage（）</strong>函数，我们在其中解析了图像的路径，并说明了我们想要的预测结果的数量。<strong>result_count = 5</strong>（可选1 to 1000）。<strong>.predictImage（）</strong>函数将返回预测的对象名和相应的百分比概率（<strong>percentage_probabilities</strong>）。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">eachPrediction</span><span class="p">,</span> <span class="n">eachProbability</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">eachPrediction</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="n">eachProbability</span><span class="p">)</span>
</pre></div>
</div>
<p>上面的行获取了<strong>predictions</strong>数组中的每个对象，并从<strong>percentage_probabilities中</strong>获得了相应的百分比概率，最后将两者的结果打印到console。</p>
</div>
<div class="section" id="">
<span id="id2"></span><h2><a class="reference external" href="#multiple-images-prediction"></a><strong>多图像预测</strong><a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>您可以使用单个函数（或多个<strong>.predictMultipleImages（）</strong> 函数<strong>）</strong>在多个图像上运行图像预测。</p>
<p>它的工作原理如下：</p>
<ul class="simple">
<li>定义普通的<strong>ImagePrediction</strong>实例</li>
<li>设置模型类型和模型路径</li>
<li>调用<strong>.loadModel（）</strong>函数载入模型</li>
<li>创建一个数组并将所有要预测的图像的字符串路径添加到阵列。</li>
<li>然后通过调用<strong>.predictMultipleImages（）</strong>函数执行预测并解析图像数组，并通过解析<strong>result_count_per_image = 5</strong>（默认值为2）设置每个图像所需的数字预测值</li>
</ul>
<p>以下是示例代码：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">imageai.Prediction</span> <span class="k">import</span> <span class="n">ImagePrediction</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">execution_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

<span class="n">multiple_prediction</span> <span class="o">=</span> <span class="n">ImagePrediction</span><span class="p">()</span>
<span class="n">multiple_prediction</span><span class="o">.</span><span class="n">setModelTypeAsResNet</span><span class="p">()</span>
<span class="n">multiple_prediction</span><span class="o">.</span><span class="n">setModelPath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">execution_path</span><span class="p">,</span> <span class="s2">&quot;resnet50_weights_tf_dim_ordering_tf_kernels.h5&quot;</span><span class="p">))</span>
<span class="n">multiple_prediction</span><span class="o">.</span><span class="n">loadModel</span><span class="p">()</span>

<span class="n">all_images_array</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">all_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">execution_path</span><span class="p">)</span>
<span class="k">for</span> <span class="n">each_file</span> <span class="ow">in</span> <span class="n">all_files</span><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span><span class="n">each_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">each_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)):</span>
        <span class="n">all_images_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each_file</span><span class="p">)</span>

<span class="n">results_array</span> <span class="o">=</span> <span class="n">multiple_prediction</span><span class="o">.</span><span class="n">predictMultipleImages</span><span class="p">(</span><span class="n">all_images_array</span><span class="p">,</span> <span class="n">result_count_per_image</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">each_result</span> <span class="ow">in</span> <span class="n">results_array</span><span class="p">:</span>
<span class="n">predictions</span><span class="p">,</span> <span class="n">percentage_probabilities</span> <span class="o">=</span> <span class="n">each_result</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">],</span> <span class="n">each_result</span><span class="p">[</span><span class="s2">&quot;percentage_probabilities&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)):</span>
<span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="n">percentage_probabilities</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>在上面的代码中，<strong>.predictMultipleImages（）</strong>函数将返回一个数组，其中包含每个图像的字典。每个字典包含用于预测的图像名和每个预测的百分比概率。</p>
<p>示例结果：</p>
<p><a class="reference external" href="/OlafenwaMoses/ImageAI/blob/master/images/1.jpg"><img alt="" src="https://github.com/OlafenwaMoses/ImageAI/raw/master/images/1.jpg" /></a> <a class="reference external" href="/OlafenwaMoses/ImageAI/blob/master/images/2.jpg"><img alt="" src="https://github.com/OlafenwaMoses/ImageAI/raw/master/images/2.jpg" /></a> <a class="reference external" href="/OlafenwaMoses/ImageAI/blob/master/images/3.jpg"><img alt="" src="https://github.com/OlafenwaMoses/ImageAI/raw/master/images/3.jpg" /></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">convertible</span> <span class="p">:</span> <span class="mf">52.459555864334106</span>
<span class="n">sports_car</span> <span class="p">:</span> <span class="mf">37.61284649372101</span>
<span class="n">pickup</span> <span class="p">:</span> <span class="mf">3.1751200556755066</span>
<span class="n">car_wheel</span> <span class="p">:</span> <span class="mf">1.817505806684494</span>
<span class="n">minivan</span> <span class="p">:</span> <span class="mf">1.7487050965428352</span>
<span class="o">-----------------------</span>
<span class="n">toilet_tissue</span> <span class="p">:</span> <span class="mf">13.99008333683014</span>
<span class="n">jeep</span> <span class="p">:</span> <span class="mf">6.842949986457825</span>
<span class="n">car_wheel</span> <span class="p">:</span> <span class="mf">6.71963095664978</span>
<span class="n">seat_belt</span> <span class="p">:</span> <span class="mf">6.704962253570557</span>
<span class="n">minivan</span> <span class="p">:</span> <span class="mf">5.861184373497963</span>
<span class="o">-----------------------</span>
<span class="n">bustard</span> <span class="p">:</span> <span class="mf">52.03368067741394</span>
<span class="n">vulture</span> <span class="p">:</span> <span class="mf">20.936034619808197</span>
<span class="n">crane</span> <span class="p">:</span> <span class="mf">10.620515048503876</span>
<span class="n">kite</span> <span class="p">:</span> <span class="mf">10.20539253950119</span>
<span class="n">white_stork</span> <span class="p">:</span> <span class="mf">1.6472270712256432</span>
<span class="o">-----------------------</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id3"></span><h2><a class="reference external" href="#prediction-speed"></a><strong>预测速度</strong><a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p><strong>ImageAI</strong>现在为所有图像预测任务提供预测速度。预测速度允许您以20％到60％之间的速率减少预测时间，轻微的变化就能准确地预测结果。可用的预测速度是”normal”, “fast”, “faster” and “fastest” 。您需要做的就是在加载模型时说明您想要的速度模式，如下所示。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prediction</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span><span class="n">prediction_speed</span><span class="o">=</span><span class="s2">&quot;fast&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>为了观察预测速度的差异，请查看下面应用于多个预测的每个速度以及给定的预测和预测所花费的时间。以下结果来自于采用Intel Celeron N2820 CPU的Windows 8笔记本电脑进行的预测，处理器速度为2.13GHz</p>
<p><strong><em>预测速度=“正常”，预测时间= 5.9秒</em></strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">convertible</span> <span class="p">:</span> <span class="mf">52.459555864334106</span>
<span class="n">sports_car</span> <span class="p">:</span> <span class="mf">37.61284649372101</span>
<span class="n">pickup</span> <span class="p">:</span> <span class="mf">3.1751200556755066</span>
<span class="n">car_wheel</span> <span class="p">:</span> <span class="mf">1.817505806684494</span>
<span class="n">minivan</span> <span class="p">:</span> <span class="mf">1.7487050965428352</span>
<span class="o">-----------------------</span>
<span class="n">toilet_tissue</span> <span class="p">:</span> <span class="mf">13.99008333683014</span>
<span class="n">jeep</span> <span class="p">:</span> <span class="mf">6.842949986457825</span>
<span class="n">car_wheel</span> <span class="p">:</span> <span class="mf">6.71963095664978</span>
<span class="n">seat_belt</span> <span class="p">:</span> <span class="mf">6.704962253570557</span>
<span class="n">minivan</span> <span class="p">:</span> <span class="mf">5.861184373497963</span>
<span class="o">-----------------------</span>
<span class="n">bustard</span> <span class="p">:</span> <span class="mf">52.03368067741394</span>
<span class="n">vulture</span> <span class="p">:</span> <span class="mf">20.936034619808197</span>
<span class="n">crane</span> <span class="p">:</span> <span class="mf">10.620515048503876</span>
<span class="n">kite</span> <span class="p">:</span> <span class="mf">10.20539253950119</span>
<span class="n">white_stork</span> <span class="p">:</span> <span class="mf">1.6472270712256432</span>
<span class="o">-----------------------</span>
</pre></div>
</div>
<p><strong><em>预测速度=“快速”，预测时间= 3.4秒</em></strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sports_car</span> <span class="p">:</span> <span class="mf">55.5136501789093</span>
<span class="n">pickup</span> <span class="p">:</span> <span class="mf">19.860029220581055</span>
<span class="n">convertible</span> <span class="p">:</span> <span class="mf">17.88402795791626</span>
<span class="n">tow_truck</span> <span class="p">:</span> <span class="mf">2.357563190162182</span>
<span class="n">car_wheel</span> <span class="p">:</span> <span class="mf">1.8646160140633583</span>
<span class="o">-----------------------</span>
<span class="n">drum</span> <span class="p">:</span> <span class="mf">12.241223454475403</span>
<span class="n">toilet_tissue</span> <span class="p">:</span> <span class="mf">10.96322312951088</span>
<span class="n">car_wheel</span> <span class="p">:</span> <span class="mf">10.776633024215698</span>
<span class="n">dial_telephone</span> <span class="p">:</span> <span class="mf">9.840480983257294</span>
<span class="n">toilet_seat</span> <span class="p">:</span> <span class="mf">8.989936858415604</span>
<span class="o">-----------------------</span>
<span class="n">vulture</span> <span class="p">:</span> <span class="mf">52.81011462211609</span>
<span class="n">bustard</span> <span class="p">:</span> <span class="mf">45.628002285957336</span>
<span class="n">kite</span> <span class="p">:</span> <span class="mf">0.8065823465585709</span>
<span class="n">goose</span> <span class="p">:</span> <span class="mf">0.3629807382822037</span>
<span class="n">crane</span> <span class="p">:</span> <span class="mf">0.21266008261591196</span>
<span class="o">-----------------------</span>
</pre></div>
</div>
<p><strong><em>预测速度=“更快”，预测时间= 2.7秒</em></strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sports_car</span> <span class="p">:</span> <span class="mf">79.90474104881287</span>
<span class="n">tow_truck</span> <span class="p">:</span> <span class="mf">9.751049429178238</span>
<span class="n">convertible</span> <span class="p">:</span> <span class="mf">7.056044787168503</span>
<span class="n">racer</span> <span class="p">:</span> <span class="mf">1.8735893070697784</span>
<span class="n">car_wheel</span> <span class="p">:</span> <span class="mf">0.7379394955933094</span>
<span class="o">-----------------------</span>
<span class="n">oil_filter</span> <span class="p">:</span> <span class="mf">73.52778315544128</span>
<span class="n">jeep</span> <span class="p">:</span> <span class="mf">11.926891654729843</span>
<span class="n">reflex_camera</span> <span class="p">:</span> <span class="mf">7.9965077340602875</span>
<span class="n">Polaroid_camera</span> <span class="p">:</span> <span class="mf">0.9798810817301273</span>
<span class="n">barbell</span> <span class="p">:</span> <span class="mf">0.8661789819598198</span>
<span class="o">-----------------------</span>
<span class="n">vulture</span> <span class="p">:</span> <span class="mf">93.00530552864075</span>
<span class="n">bustard</span> <span class="p">:</span> <span class="mf">6.636220961809158</span>
<span class="n">kite</span> <span class="p">:</span> <span class="mf">0.15161558985710144</span>
<span class="n">bald_eagle</span> <span class="p">:</span> <span class="mf">0.10513027664273977</span>
<span class="n">crane</span> <span class="p">:</span> <span class="mf">0.05982434959150851</span>
<span class="o">-----------------------</span>
</pre></div>
</div>
<p><strong><em>预测速度=“最快”，预测时间= 2.2秒</em></strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tow_truck</span> <span class="p">:</span> <span class="mf">62.5033438205719</span>
<span class="n">sports_car</span> <span class="p">:</span> <span class="mf">31.26143217086792</span>
<span class="n">racer</span> <span class="p">:</span> <span class="mf">2.2139860317111015</span>
<span class="n">fire_engine</span> <span class="p">:</span> <span class="mf">1.7813067883253098</span>
<span class="n">ambulance</span> <span class="p">:</span> <span class="mf">0.8790366351604462</span>
<span class="o">-----------------------</span>
<span class="n">reflex_camera</span> <span class="p">:</span> <span class="mf">94.00787949562073</span>
<span class="n">racer</span> <span class="p">:</span> <span class="mf">2.345871739089489</span>
<span class="n">jeep</span> <span class="p">:</span> <span class="mf">1.6016140580177307</span>
<span class="n">oil_filter</span> <span class="p">:</span> <span class="mf">1.4121259562671185</span>
<span class="n">lens_cap</span> <span class="p">:</span> <span class="mf">0.1283118617720902</span>
<span class="o">-----------------------</span>
<span class="n">kite</span> <span class="p">:</span> <span class="mf">98.5377550125122</span>
<span class="n">vulture</span> <span class="p">:</span> <span class="mf">0.7469987496733665</span>
<span class="n">bustard</span> <span class="p">:</span> <span class="mf">0.36855682265013456</span>
<span class="n">bald_eagle</span> <span class="p">:</span> <span class="mf">0.2437378279864788</span>
<span class="n">great_grey_owl</span> <span class="p">:</span> <span class="mf">0.0699841941241175</span>
<span class="o">-----------------------</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id4"></span><h2><a class="reference external" href="#please-note"></a>请注意：<a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>调整速度模式时，最好使用具有更高精度的模型，如DenseNet或InceptionV3模型，或者在预测图像具有标志性的情况下使用它。</p>
</div>
<div class="section" id="">
<span id="id5"></span><h2><a class="reference external" href="#image-input-types"></a><strong>图像输入类型</strong><a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>以前版本的<strong>ImageAI</strong>仅支持文件输入，并接受图像的文件路径以进行图像预测。现在，<strong>ImageAI</strong>支持3种输入类型，即<strong>图像文件的文件路径</strong>（默认），<strong>图像numpy数组</strong>和<strong>图像文件流</strong>。这意味着您现在可以在生产应用程序中执行图像预测，例如在Web服务器和以上述任何格式返回文件到系统上。</p>
<p>要使用numpy数组或文件流输入执行图像预测，您只需要在<strong>.predictImage（）</strong>函数或<strong>.predictMultipleImages（）</strong>函数中声明输入类型。见下面的例子。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">predictImage</span><span class="p">(</span><span class="n">image_array</span><span class="p">,</span> <span class="n">result_count</span><span class="o">=</span><span class="mi">5</span> <span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="s2">&quot;array&quot;</span> <span class="p">)</span> <span class="c1"># For numpy array input type</span>
<span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">predictImage</span><span class="p">(</span><span class="n">image_stream</span><span class="p">,</span> <span class="n">result_count</span><span class="o">=</span><span class="mi">5</span> <span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="s2">&quot;stream&quot;</span> <span class="p">)</span> <span class="c1"># For file stream input type</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id6"></span><h2><a class="reference external" href="#prediction-in-multithreading"></a><strong>多线程预测</strong><a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p>在开发像用户界面（UI）这样的deafult线程上运行繁重任务的程序时，您应该考虑在新线程中运行预测。在新线程中使用ImageAI运行图像预测时，必须注意以下事项：</p>
<ul class="simple">
<li>您可以创建预测对象，设置其模型类型，在新线程外设置模型路径和json路径。</li>
<li><strong>.loadModel（）</strong>必须在新线程中，并且图像预测（<strong>predictImage（）</strong>）必须在新线程中进行。</li>
</ul>
<p>使用多线程查看下面的图像预测示例代码：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">imageai.Prediction</span> <span class="k">import</span> <span class="n">ImagePrediction</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="n">execution_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">ImagePrediction</span><span class="p">()</span>
<span class="n">prediction</span><span class="o">.</span><span class="n">setModelTypeAsResNet</span><span class="p">()</span>
<span class="n">prediction</span><span class="o">.</span><span class="n">setModelPath</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">execution_path</span><span class="p">,</span> <span class="s2">&quot;resnet50_weights_tf_dim_ordering_tf_kernels.h5&quot;</span><span class="p">))</span>

<span class="n">picturesfolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;USERPROFILE&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;\Pictures</span><span class="se">\&quot;</span>
<span class="n">allfiles</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">picturesfolder</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">PredictionThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">prediction</span><span class="o">.</span><span class="n">loadModel</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">eachPicture</span> <span class="ow">in</span> <span class="n">allfiles</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">eachPicture</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">eachPicture</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">):</span>
            <span class="n">predictions</span><span class="p">,</span> <span class="n">percentage_probabilities</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">predictImage</span><span class="p">(</span><span class="n">picturesfolder</span> <span class="o">+</span> <span class="n">eachPicture</span><span class="p">,</span> <span class="n">result_count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">percentage_probability</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">prediction</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="n">percentage_probability</span><span class="p">)</span>

<span class="n">predictionThread</span> <span class="o">=</span> <span class="n">PredictionThread</span> <span class="p">()</span>
<span class="n">predictionThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="">
<span id="id7"></span><h2><a class="reference external" href="#documentation"></a><strong>文档</strong><a class="headerlink" href="#" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">imageai.Prediction.ImagePrediction</span></code> class</p>
<hr class="docutils" />
<p>该<code class="docutils literal notranslate"><span class="pre">ImagePrediction</span></code>类可用于任何的Python应用程序通过实例化它并调用下面的可用功能进行图像预测：</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">setModelTypeAsSqueezeNet()</span></code>如果您选择使用SqueezeNet模型文件来预测图像，你需要调用这个函数。你只需要调用一次。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">setModelTypeAsResNet()</span></code>如果您选择使用ResNet模型文件来预测图像，你需要调用这个函数。你只需要调用一次。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">setModelTypeAsInceptionV3()</span></code>如果您选择使用InceptionV3Net模型文件来预测图像，你需要调用这个函数。你只需要调用一次。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">setModelTypeAsDenseNet()</span></code>如果您选择使用DenseNet模型文件来预测图像，你需要调用这个函数。你只需要调用一次。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">setModelPath()</span></code> 您只需要调用此函数一次，并将模型文件路径的路径解析为字符串。模型文件类型必须与您设置的模型类型相对应。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">loadModel()</span></code> 只有在尝试调用<code class="docutils literal notranslate"><span class="pre">predictImage()</span></code>函数之前，才需要调用此函数一次。
该函数接收一个<code class="docutils literal notranslate"><span class="pre">prediction_speed</span></code>的可选值。该值用于减少预测图像所需的时间，降至正常时间的约60％，只需稍微改变或预测精度下降，具体取决于图像的性质。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">prediction_speed</span></code>（可选）; 可接受的值是”normal”, “fast”, “faster” and “fastest”</li>
</ul>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">predictImage()</span></code> 此函数用于通过接收以下参数来预测指定图像：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">input_type</span></code>（可选），类型要解析的输入。可接受的值是“file”，“array”和“stream”</li>
<li><code class="docutils literal notranslate"><span class="pre">image_input</span></code>，文件路径/ numpy数组/图像文件流的图像。</li>
<li><code class="docutils literal notranslate"><span class="pre">result_count</span></code>（可选），要发送的预测数，必须是
1到1000之间的整数。默认值为5.</li>
</ul>
<p>此函数返回2个数组，即’prediction_results’和’prediction_probabilities’。’prediction_results’包含按百分比概率降序排列的可能对象类。’prediction_probabilities’包含每个对象类的概率百分比。
数组中每个对象类的位置对应于’prediction_probabilities’ 数组中百分比可能性。</p>
<p><em><strong>：param input_type:</strong></em></p>
<p><em><strong>：param image_input:</strong></em></p>
<p><em><strong>：param result_count:</strong></em></p>
<p><em><strong>：return prediction_results，prediction_probabilities:</strong></em></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">predictMultipleImages()</span></code>此函数用于通过接收以下参数来预测多个图像：</p>
<ul class="simple">
<li>input_type，解析数组中包含的输入类型。可接受的值是“file”，“array”和“stream”</li>
<li>sent_images_array，图像文件路径数组，图像numpy数组或图像文件流</li>
<li>result_count_per_image（可选），数量每个图像要发送的预测，必须是1到1000之间的整数。默认值为2。</li>
</ul>
<p>此函数返回一个字典数组，每个字典包含2个数组，即’prediction_results’和’prediction_probabilities’。’prediction_results’包含按其百分比概率降序排列的可能对象类。’prediction_probabilities’包含每个对象类的概率百分比。’prediction_results’数组中每个对象类的位置对应于’prediction_probabilities’数组中百分比可能性。</p>
<p><strong><em>:param input_type:</em></strong></p>
<p><strong><em>:param sent_images_array:</em></strong></p>
<p><strong><em>:param result_count_per_image:</em></strong></p>
<p><strong><em>:return output_array:</em></strong></p>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, kangvcar.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'v1.0',
            LANGUAGE:'zh_CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>